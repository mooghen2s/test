/*!
 * 
 *     MCAFEE RESTRICTED CONFIDENTIAL
 *     Copyright (c) 2024 McAfee, LLC
 *
 *     The source code contained or described herein and all documents related
 *     to the source code ("Material") are owned by McAfee or its
 *     suppliers or licensors. Title to the Material remains with McAfee
 *     or its suppliers and licensors. The Material contains trade
 *     secrets and proprietary and confidential information of McAfee or its
 *     suppliers and licensors. The Material is protected by worldwide copyright
 *     and trade secret laws and treaty provisions. No part of the Material may
 *     be used, copied, reproduced, modified, published, uploaded, posted,
 *     transmitted, distributed, or disclosed in any way without McAfee's prior
 *     express written permission.
 *
 *     No license under any patent, copyright, trade secret or other intellectual
 *     property right is granted to or conferred upon you by disclosure or
 *     delivery of the Materials, either expressly, by implication, inducement,
 *     estoppel or otherwise. Any license under such intellectual property rights
 *     must be expressed and approved by McAfee in writing.
 *
 */(()=>{"use strict";const e="SHOW_MB_SIDEBAR",t="MB_VIDEO_FLAGGED",n="PING_CONTENT_MB_BANNER",i="MB_BANNER_SHOW",o="MB_BANNER_REMOVE",r="BROADCAST_MB_UPDATE_UI",s={NONE:0,LINKEDIN:1,INSTAGRAM:2,YOUTUBE:4,FACEBOOK:8,TWITTER:16,REDDIT:32},a=(Object.values(s).reduce(((e,t)=>e+t)),{NONE:"NONE",ONLY_SECURE_SEARCH:"ONLY_SECURE_SEARCH",ALL:"ALL",*[Symbol.iterator](){for(const e of Object.keys(this))yield e}}),{NONE:l,...d}=s,c={name:"FINGER_PRINT",type:"number"},h={name:"FIRST_PARTY",type:"number"},u={name:"THIRD_PARTY",type:"number"},m=chrome,p=(Symbol.iterator,m.runtime.getURL(""),c.name,h.name,u.name,"enabled");const f=0,b=0,g=1,y=2,B=3,T=4,E=1,v=2,N=3,w=4,x={BACKGROUND:"BACKGROUND",CONTENT:"CONTENT",TELEMETRY:"TELEMETRY"},A={DEFAULT:"color: #000000; font-weight: normal; font-style:normal; background: #FFFFFF;",BACKGROUND:"color: #8D0DBA; font-weight: bold; background: #FFFFFF;",CONTENT:"color: #F54A26; font-weight: bold; background: #FFFFFF;",TELEMETRY:"color: #147831; font-weight: bold; background: #FFFFFF;"};class I{static log(e,t=null){L(e,E,t)}static error(e,t=null){L(e,v,t)}static warn(e,t=null){L(e,N,t)}static debug(e,t=null){L(e,w,t)}}const L=(e,t,n)=>{const i=f;if(i===b)return;let o="chrome-extension:"===location.protocol?x.BACKGROUND:x.CONTENT;n&&x[n]&&(o=n);const r=new Date,s=t===v?e:`%c[${o} ${r.toLocaleString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}]: %c${e}`,a=A.DEFAULT;let l=A[o];if(l||(l=a),i>=y&&t===v&&console.error(e),i>=g&&t===E&&console.log(s,l,a),i>=B&&t===N){const e="color: #FFA500; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cWARN - ${s}`,e,l,a)}if(i>=T&&t===w){const e="color: #FF33D7; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cDEBUG - ${s}`,e,l,a)}},D=(e,t=null,n)=>{"function"==typeof n?chrome.runtime.onMessage.addListener(((i,o,r)=>{if(o.id===chrome.runtime.id&&"object"==typeof i&&!Array.isArray(i)&&i?.ipcId===e)return n({promises:t,request:i,sender:o,sendResponse:r})})):I.error("Provided with invalid callback function")};class S{constructor(e){this.pingCommand=e,this.basePingListener(),this.addIdentifier()}basePingListener(e=null){D("WA",null,(({request:t,sendResponse:n})=>{const{command:i}=t;if(i===this.pingCommand)return I.debug(`File Injection [pinged]: Received ${i} command`),n({content:!0}),"function"==typeof e&&e(),!0}))}addIdentifier(){var e;e=()=>{const e=document.createElement("span");e.id=this.pingCommand,e.style.cssText="display:none",document.body.appendChild(e)},"undefined"!=typeof document&&null!==document&&("complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e))}}const $=async(e,t,n,i)=>{try{O(e,t,n,i)}catch(e){I.warn(`[broadcast] Unexpected error when calling command: "${t}", err: ${e.message}`)}},O=(e,t,n,i,o=null)=>{if(!chrome.tabs)throw new Error('"tabs" permission not set in manifest.');return chrome.tabs.sendMessage(i,{ipcId:e,command:t,...n},{frameId:o})},R=(e,t={},n)=>(async(e,t,n={},i={})=>{try{if(i?.tabId){const{tabId:o,frameId:r}=i;return await O(e,t,n,o,r)}if(i?.broadcast){const o=await chrome.tabs.query({}),{broadcastIgnoreId:r=[]}=i;return o.filter((({id:e})=>!r.includes(e))).forEach((({id:i})=>{$(e,t,n,i)})),!0}return await chrome.runtime.sendMessage({ipcId:e,command:t,...n})}catch(e){return I.warn(`Unexpected error when calling command: "${t}", err: ${e.message}`),null}})("WA",e,t,n);class C{static geti18nRes(e,t=[]){let n=m.i18n.getMessage(e,t);const i=m.i18n.getMessage("res_PRODUCT_NAME_TRADEMARKED");return n=n.replace(/%PRODUCTNAME%/g,i),n}static getResStr(e,t){const n=C.geti18nRes(e);t("??"===n?"":n)}static async getFileSource(e){try{return(await fetch(m.runtime.getURL(e))).text()}catch(e){return""}}}class F{constructor(e=null,t=document){if(this.resourcerequestor=C,this.document=t,e){const t=this.document.querySelectorAll(`#${e}`);t&&(this.document=t[0].contentDocument)}this.localeData=this.localeData.bind(this),this.fillText=this.fillText.bind(this),this.fillLocalizedTexts=this.fillLocalizedTexts.bind(this),this.fillInputPlaceHolders=this.fillInputPlaceHolders.bind(this)}localeData(e,t=[]){return this.resourcerequestor.geti18nRes(e,t)}fillText(e,t){const n=this.document.getElementById(e);if(n){const e=n.getAttribute("x-mcinsertposition");if(e)return void n.insertAdjacentText(e,t);n.textContent=t,n.setAttribute("x-mcl10nprocessed",!0)}}fillLocalizedTexts(){for(const{id:e}of this.document.querySelectorAll("*[x-mclocalizedtext]:not([x-mcl10nprocessed=true])")){const t=this.localeData(e);if(null==t)return!1;this.fillText(e,t)}return!0}fillInputPlaceHolders(){for(const{id:e}of this.document.querySelectorAll("*[x-inputplaceholder]")){const t=this.localeData(e),n=this.document.getElementById(e);if(null==t)return!1;null!=n&&n.setAttribute("placeholder",t)}return!0}init(){this.fillLocalizedTexts(),this.fillInputPlaceHolders()}}const _=e=>{let{top:t,left:n}=M(e);return t<0&&(t=0),n<0&&(n=0),{top:t,left:n}},M=e=>{const t=e.getBoundingClientRect(),n=window.pageYOffset||window.scrollY,i=window.pageXOffset||window.scrollX;return{top:Math.round(t.top+n),left:Math.round(t.left+i),bottom:Math.round(t.bottom+n),right:Math.round(t.right+i)}},P="AI",H="NO_AI",U="FULL_BANNER",z="ON_HOVER",V="ICON_ONLY",k="afterend",q="afterbegin";class W{constructor(e,t){this.strConvertor=new F,this.colors={white:"#FFFFFF",red:"#C01818",black:"#343434"},this.bannerData={[P]:{bgc:this.colors.red,fontColor:this.colors.white,borderColor:"rgba(255, 255, 255, 0.4)",title:this.strConvertor.localeData("mb_video_banner_AI_audio_title"),closeBtn:`${chrome.runtime.getURL("images/banner/close_icon_white.svg")}`,icon:`${chrome.runtime.getURL("images/banner/ai_icon_white.svg")}`},[H]:{bgc:this.colors.white,fontColor:this.colors.black,borderColor:"rgba(110, 110, 110, 0.4)",title:this.strConvertor.localeData("mb_video_banner_no_AI_audio_title"),closeBtn:`${chrome.runtime.getURL("images/banner/close_icon_black.svg")}`,icon:`${chrome.runtime.getURL("images/banner/ai_icon_red.svg")}`}},this.bannerId=e,this.videoElement=t,this.bannerNode=null,this.payload=null,this.timer=null,this.bannerType=null,this.topParentNode=null,this.isParentDefaultP=!1,this.srcUrl=null}getBannerDetailsByVideoSize(){return this.videoElement.offsetWidth>=1081?{fontSize:22,lineHeight:37,bannerH:60,closeBtnH:30,aiIconSize:30,bannerAnimationType:U}:this.videoElement.offsetWidth>=721?{fontSize:18,lineHeight:28,bannerH:46,closeBtnH:23,aiIconSize:23,bannerAnimationType:z}:this.videoElement.offsetWidth>=481?{fontSize:15,lineHeight:23,bannerH:38,closeBtnH:19,aiIconSize:19,bannerAnimationType:z}:{fontSize:15,lineHeight:23,bannerH:38,closeBtnH:19,aiIconSize:19,bannerAnimationType:V}}init(e,t){this.payload=t,this.bannerType=e,this.injectfont(),this.bannerNode=document.createElement("div"),this.bannerNode.setAttribute("id",`${this.bannerId}`),this.initBannerListeners(),this.setBannerElement(),this.appendBannerToVideoContainer(),window.addEventListener("resize",(()=>{this.updateBannerPosition()}),!1),window.addEventListener("scroll",(()=>{this.updateBannerPosition()}),!1);const{srcurl:n,topurl:i}=this.payload;this.srcUrl=n??i}injectfont(){try{const e="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,400;0,500;0,600;0,800;1,400;1,500;1,600;1,800&display=swap",t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)}catch(e){I.error(e)}}setBannerElement(){const{fontSize:e,closeBtnH:n,bannerH:i,lineHeight:o,aiIconSize:r,bannerAnimationType:s}=this.getBannerDetailsByVideoSize(),a=this.bannerType;this.bannerType===P&&R(t);const l=`\n      position: absolute;\n      top: 10px;\n      left: 10px;\n      border-radius: ${i}px;\n      margin: 10px;\n      z-index: 2147483647;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      font-family: Poppins;\n      opacity: 1;\n      box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.2);\n      height: ${i}px;\n      width:  ${i}px;\n      background-color: ${this.bannerData[a].bgc};\n      gap: 3px;\n      overflow: hidden;\n      -webkit-transition: all 0.3s ease-in-out;\n      -moz-transition: all 0.3s ease-in-out;\n      transition: all 0.3s ease-in-out;\n      -webkit-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    `;this.bannerNode.style=l;const d=`\n      height: ${r}px;\n      width: ${r}px;\n    `,c=`\n      display: flex;\n      color: ${this.bannerData[a].fontColor}; \n      line-height: ${o}px; \n      font-size: ${e}px; \n      font-weight: 600;\n      text-wrap: nowrap;\n    `,h=`\n      display: flex; \n      align-items: center; \n      border-left: 1px solid ${this.bannerData[a].borderColor};\n      margin: 0px 13px;\n    `,u=`\n      <div style='position: relative; height: ${i}px; width: ${i}px;'>\n        <div style='position: absolute; height: ${i}px; width: ${i}px; display: flex; justify-content: center; align-items: center'>\n          <img id='videoBannerIcon' src='${this.bannerData[a].icon}' style='${d}' />\n        </div>\n        <div style='height: ${i}px; width: ${i}px;'></div>\n      </div>\n    `,m=`\n      <div id="videoBannerContentContainer" style='display: flex; align-items: center; opacity: 0;'>\n        <div id='videoBannerTitle' style='${c}'>${this.bannerData[a].title}</div>\n        <div id='videoBannerCloseBtn' style='${h}'>\n          <img src='${this.bannerData[a].closeBtn}' style='padding-left:${e-10}px; height:${n}px;'/>\n        </div>\n      </div>\n    `,p=`${u}${V!==s?m:""}`;if(this.bannerNode.innerHTML=p,V!==s){const e=this.bannerNode.querySelector("#videoBannerCloseBtn");e?.addEventListener("click",(e=>{e.stopPropagation(),this.hideBanner()}))}s===U&&setTimeout((()=>this.animateBanner(!0)),250),this.bannerType===H&&this.closeBannerOnTimeout(this.bannerType)}initBannerListeners(){this.bannerNode.addEventListener("click",(t=>{t.stopPropagation(),R(e,{mbVideoId:this.payload.id});const{bannerAnimationType:n}=this.getBannerDetailsByVideoSize();V===n&&this.hideBanner()})),this.bannerNode.addEventListener("mouseenter",(({currentTarget:e})=>{this.handleMouseEnterLeave("mouseenter",e)})),this.bannerNode.addEventListener("mouseleave",(({currentTarget:e})=>{this.handleMouseEnterLeave("mouseleave",e)}))}handleMouseEnterLeave(e){const{bannerAnimationType:t}=this.getBannerDetailsByVideoSize();t===z&&this.animateBanner("mouseenter"===e),this.bannerType===H&&("mouseenter"===e&&clearTimeout(this.timer),"mouseleave"===e&&this.closeBannerOnTimeout(this.bannerType))}animateBanner(e=!0){const{bannerH:t}=this.getBannerDetailsByVideoSize(),n=this.bannerNode.querySelector("#videoBannerContentContainer");n&&(this.bannerNode.style.width=e?`${n.offsetWidth+t}px`:`${t}px`,n.style.opacity=e?1:0)}closeBannerOnTimeout(){this.timer=setTimeout((()=>{this.hideBanner()}),3e3)}hideBanner(){const{bannerAnimationType:e}=this.getBannerDetailsByVideoSize();V!==e&&this.animateBanner(!1),this.fadeOut(this.bannerNode,25,(()=>{this.bannerNode.innerHTML="",this.bannerNode.style.display="none"}))}updateBannerUI(e,t,n){this.srcUrl=t,this.payload=n,clearTimeout(this.timer),this.bannerType=e,this.setBannerElement(),this.updateBannerPosition()}appendBannerToVideoContainer(){this.topParentNode=(e=>{let t=e.parentElement;if(null===t)return e;let n=_(t);const i=_(e);let o=e;for(;null!==t&&i.top===n.top&&i.left===n.left;)o=t,t=t.parentElement,null!==t&&(n=_(t));return o})(this.videoElement),this.isParentDefaultP=["relative","fixed"].includes(window.getComputedStyle(this.topParentNode).getPropertyValue("position")),this.bannerNode.style.top=`${this.isParentDefaultP?10:this.topParentNode.offsetTop}px`,this.bannerNode.style.left=`${this.isParentDefaultP?10:this.topParentNode.offsetLeft}px`;const e="VIDEO"===this.topParentNode.tagName?k:q;this.topParentNode.insertAdjacentElement(e,this.bannerNode)}fadeIn(e,t,n){this.fadeInTimer=setInterval((()=>{e.style.opacity<1?e.style.opacity+=.2:(clearInterval(this.fadeInTimer),n())}),t)}fadeOut(e,t,n){this.fadeOutTimer=setInterval((()=>{e.style.opacity>0?e.style.opacity-=.2:(clearInterval(this.fadeOutTimer),n())}),t)}updateBannerPosition(){this.bannerNode.style.top=`${this.isParentDefaultP?10:this.topParentNode.offsetTop}px`,this.bannerNode.style.left=`${this.isParentDefaultP?10:this.topParentNode.offsetLeft}px`}closeBanner(){this.bannerNode.innerHTML="",this.bannerNode.style.display="none"}}class Y{constructor(){this.banners={}}showBannerOnVideo(e,t){const{finalresult:n,srcurl:i,topurl:o}=t;if(0===e.offsetWidth||0===e.offsetHeight)return;const r=n?P:H,{id:s,videoBanner:a}=this.getVideoBanner(e);if(!a){const n=`m${(Math.random()+1).toString(36).slice(2)}`,i=new W(n,e);return i.init(r,t),void(this.banners[n]={videoElement:e,videoBanner:i})}const l=i??o;e.src&&e.src!==l?I.log("[MB:showBannerOnVideo] video src changed, ignoring response from native to show banner."):(l!==a.srcUrl||a.bannerType!==r&&r===P)&&(a.updateBannerUI(r,l,t),this.banners[s]={videoElement:e,videoBanner:a})}getVideoBanner(e){for(const[t,{videoElement:n,videoBanner:i}]of Object.entries(this.banners))if(n.isSameNode(e))return{id:t,videoBanner:i};return{}}removeBannerFromVideo(e){const{id:t,videoBanner:n}=this.getVideoBanner(e);n&&(delete this.banners[t],n.closeBanner())}}(new class extends S{constructor(){super(n),this.bannerHandler=new Y,this.mockingbirdState=null}async main(){this.messageListener()}messageListener(){D("WA",null,(({request:e,sendResponse:t})=>{const{command:n,payload:s}=e;if(n===i)return this.showBanner(s),t({content:!0}),!0;if(n===o)return this.removeBanner(s.id),t({content:!0}),!0;if(n===r){const{status:t,enabled:n}=e;return this.mockingbirdState={status:t,enabled:n},void(!this.mockingbirdState||this.mockingbirdState.enabled&&this.mockingbirdState.status===p||this.removeAllBanners())}}))}showBanner(e){try{const{id:t}=e,{element:n,capturing:i,permissionRequired:o}=window.audioMonitor.getById(t)||{};if(o)return;if(this.mockingbirdState&&(!this.mockingbirdState.enabled||this.mockingbirdState.status!==p))return;i&&n instanceof HTMLMediaElement?this.bannerHandler.showBannerOnVideo(n,e):i&&n instanceof HTMLAudioElement||n instanceof HTMLCanvasElement&&this.bannerHandler.showBannerOnVideo(n,e)}catch(e){I.warn(`[MB] showBanner err, ${e.message}`)}}removeBanner(e){try{const{element:t}=window.audioMonitor.getById(e)||{};t instanceof HTMLMediaElement?this.bannerHandler.removeBannerFromVideo(t):t instanceof HTMLAudioElement||t instanceof HTMLCanvasElement&&this.bannerHandler.removeBannerFromVideo(t)}catch(e){I.warn(`[MB] removeBanner err, ${e.message}`)}}removeAllBanners(){(window.audioMonitor.audioInfos||[]).forEach((({id:e=null})=>this.removeBanner(e)))}}).main()})();
//# sourceMappingURL=../sourceMap/chrome/scripts/content_mb_banner.js.map